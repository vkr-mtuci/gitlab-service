# GitLab Service

## üìå –û–ø–∏—Å–∞–Ω–∏–µ
**GitLab Service** ‚Äì —ç—Ç–æ REST API-—Å–µ—Ä–≤–∏—Å, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å GitLab API. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö, –ø–∞–π–ø–ª–∞–π–Ω–∞—Ö, –∫–æ–º–º–∏—Ç–∞—Ö –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –¥–µ–ø–ª–æ–π-–¥–∂–æ–±—ã.

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–æ–º–º–∏—Ç–æ–≤ –º–µ–∂–¥—É —Å–±–æ—Ä–∫–∞–º–∏
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ deploy-–¥–∂–æ–± –¥–ª—è –ø–∞–π–ø–ª–∞–π–Ω–∞
- –ó–∞–ø—É—Å–∫ deploy-–¥–∂–æ–±—ã

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Go (Golang)** ‚Äì –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Fiber** ‚Äì –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
- **Zerolog** ‚Äì –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Resty** ‚Äì –∫–ª–∏–µ–Ω—Ç –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
- **GitLab API** ‚Äì –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å GitLab

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
### 1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```sh
git clone https://github.com/vkr-mtuci/gitlab-service.git
cd gitlab-service
```

### 2Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```sh
go mod tidy
```

### 3Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `.env`
```sh
touch .env
```
–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```
SERVER_PORT=8080
GITLAB_BASE_URL=https://gitlab.com
GITLAB_API_URL=/api/v4/projects/
GITLAB_API_TOKEN=your_personal_access_token
GITLAB_PROJECT_ID=your_project_id
JIRA_PROJECT=your_jira_project
```

### 4Ô∏è‚É£ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
```sh
go run cmd/main.go
```

## üì° API-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
### üìå –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏–π
**GET /environments**
```json
{
  "environments": [
    { "id": 1, "name": "staging" },
    { "id": 2, "name": "production" }
  ]
}
```

### üìå –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
**GET /environments/:id**
```json
{
  "environment_name": "staging",
  "deployment_date": "2025-02-06T21:22:14Z",
  "ref":"develop",
  "deploy_status": "success",
  "sha":"b0f9951803dcd80c141b667acbca9e46bace8acf",
  "pipeline_id":11111111,
  "pipeline_url":"https://gitlab.example.ru/group/project/-/pipelines/11111111",
  "job_id":2222222,
  "job_url":"https:/gitlab.example.ru/group/project/-/jobs/2222222",
  "build_version":"1.1.0"
}
```

### üìå –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–æ–≤ –º–µ–∂–¥—É —Å–±–æ—Ä–∫–∞–º–∏
**GET /commits/:ref/:sha**
```json
{
  "commits": [
    { "id":"","created_at":"","message":"","author_name":"","author_email":"","web_url":"","jira_keys":[] }
  ]
}
```

### üìå –ü–æ–ª—É—á–µ–Ω–∏–µ deploy-–¥–∂–æ–±
**GET /pipelines/:pipeline_id/deploy-jobs**
```json
{
  "deploy_jobs": [
    { "id": 7, "status": "success", "finished_at":"0001-01-01T00:00:00Z", "stage":"deploy", "web_url": "https://gitlab.com/job/7", "name":"" }
  ]
}
```

### üìå –ó–∞–ø—É—Å–∫ deploy-–¥–∂–æ–±—ã
**POST /jobs/:job_id/play**
```json
{
  "id": 7,
  "status": "pending",
  "web_url": "https://gitlab.com/job/7"
}
```

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞:
```sh
go test ./... -cover
```
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞:
```sh
go tool cover -func=./coverage/coverage.out
```

